<!doctype html>
<html>

<head>
  <title>Trace</title>
  <link rel="stylesheet" href="assets/ol3/css/ol.css" type="text/css" />
  <link rel="stylesheet" href="assets/css/samples.css" type="text/css" />
</head>

<body>

  <div id="map" class="full-map"></div>


  <div id="overlay" class="marker"><img src="assets/bus.png" class="marker" width="1" height="1"></div>
  <embed src="time.mp3" width="0" height="0" autostart="false" enablejavascript="true" id="snd">
  <script src="assets/ol3/js/ol-debug.js"></script>
  <script>
    // 11.090115,76.942066
    // 11.090147,76.941905
    function soundplay() {
      console.log("played");
      var sound = new Audio("time.mp3");
      sound.play();

    }
    let loc1 = [
      [11.016424, 76.968163],
      [11.016506, 76.968212],
      [11.016596, 76.968255],
      [11.016680, 76.968319],
      [11.016780, 76.968394],
      [11.016870, 76.968416],
      [11.016970, 76.968496],
      [11.017096, 76.968587],
      [11.017176, 76.968636],
      [11.017271, 76.968711],
      [11.017350, 76.968792],
      [11.017492, 76.968883],
      [11.017570, 76.968963],
      [11.017675, 76.969044],
      [11.017765, 76.969140],
      [11.017865, 76.969221],
      [11.017970, 76.969307],
      [11.018124, 76.969399],
      [11.018229, 76.969498],
      [11.018329, 76.969573],
      [11.018445, 76.969659],
      [11.018597, 76.969740],
      [11.018755, 76.969826],
      [11.018892, 76.969901],
      [11.019076, 76.969971],
      [11.019161, 76.970040],
      [11.019329, 76.970110],
      [11.019482, 76.970180],
      [11.019693, 76.970250],
      [11.019867, 76.970329],
      [11.020009, 76.970404],
      [11.020157, 76.970485],
      [11.020346, 76.970565],
      [11.020462, 76.970640],
      [11.020619, 76.970728],
      [11.020750, 76.970814],
      [11.020906, 76.970740],
      [11.020922, 76.970654],

      [11.020896, 76.970611],
      [11.020875, 76.970547],
      [11.020864, 76.970483],
      [11.020854, 76.970408],
      [11.020827, 76.970311],
      [11.020817, 76.970236],
      [11.020790, 76.970182],

      [11.020790, 76.970107],
      [11.020769, 76.970043],
      [11.020759, 76.969979],
      [11.020743, 76.969887],
      [11.020732, 76.969818],
      [11.020722, 76.969759],
      [11.020706, 76.969700],
      [11.020706, 76.969646],

      [11.020692, 76.969588],
      [11.020685, 76.969522],
      [11.020653, 76.969458],
      [11.020643, 76.969399],
      [11.020627, 76.969324],
      [11.020617, 76.969254],
      [11.020596, 76.969190],
      [11.020585, 76.969115],
      [11.020559, 76.969024],
      [11.020553, 76.968975],

      [11.020553, 76.968900],
      [11.020532, 76.968836],
      [11.020522, 76.968766],
      [11.020495, 76.968696],
      [11.020495, 76.968600],
      [11.020480, 76.968519],
      [11.020471, 76.968441],
      [11.020460, 76.968376],
      [11.020429, 76.968296],
      [11.020413, 76.968194],
      [11.020397, 76.968124],
      [11.020381, 76.968060],
      [11.020371, 76.967990],
      [11.020360, 76.967937],

      [11.020386, 76.967862],
      [11.020339, 76.967803],
      [11.020318, 76.967711],
      [11.020302, 76.967626],

      [11.020302, 76.967540],
      [11.020286, 76.967475],
      [11.020276, 76.967379],
      [11.020255, 76.967309],
      [11.020228, 76.967202],

      [11.020228, 76.967100],
      [11.020210, 76.967038],
      [11.020195, 76.966974],
      [11.020184, 76.966898],
      [11.020174, 76.966818],
      [11.020154, 76.966726],
      [11.020149, 76.966651],
      [11.020133, 76.966581],
      [11.020112, 76.966516],
      [11.020112, 76.966441],
      [11.020107, 76.966382],
      [11.020086, 76.966329],
      [11.020075, 76.966275],
      [11.020065, 76.966211],
      [11.020044, 76.966130],
      [11.020033, 76.966071],
      [11.020033, 76.965980],
      [11.020017, 76.965910],
      [11.020007, 76.965857],
      [11.020002, 76.965792],
      [11.019981, 76.965714],
      [11.019944, 76.965623],
      [11.019933, 76.965543],
      [11.019917, 76.965457],
      [11.019896, 76.965371],
      [11.019891, 76.965317],
      [11.019881, 76.965264],
      [11.019875, 76.965189],
      [11.019860, 76.965130],
      [11.019838, 76.965060],
      [11.019828, 76.964996],
      [11.019812, 76.964937],
      [11.019802, 76.964872],
      [11.019796, 76.964792],
      [11.019791, 76.964711],

      [11.019765, 76.964658],

      [11.019744, 76.964561],
      [11.019744, 76.964486],
      [11.019707, 76.964406],
      [11.019707, 76.964331],
      [11.019696, 76.964255],
      [11.019680, 76.964164],

      [11.019670, 76.964100],
      [11.019649, 76.964030],
      [11.019633, 76.963944],
      [11.019625, 76.963865],
      [11.019615, 76.963784],
      [11.019604, 76.963709],
      [11.019594, 76.963661],
      [11.019557, 76.963564],
      [11.019541, 76.963484],
      [11.019525, 76.963398],
      [11.019504, 76.963312],

      [11.019499, 76.963205],
      [11.019473, 76.963141],
      [11.019473, 76.963017]


    ];
    let loc = [
      [10.998027, 76.989911],
      [10.998011, 76.989986],
      [10.997995, 76.990045],
      [10.997995, 76.990115],
      [10.997943, 76.990316],
      [10.997932, 76.990386],
      [10.997927, 76.990478],
      [10.997906, 76.990547],
      [10.997916, 76.990617],
      [10.997906, 76.990687], [10.997885, 76.990724], [10.997890, 76.990799], [10.997874, 76.990858], [10.997879, 76.990939], [10.997864, 76.991009], [10.997842, 76.991078], [10.997842, 76.991164], [10.997816, 76.991234], [10.997800, 76.991304], [10.997785, 76.991395], [10.997769, 76.991481], [10.997763, 76.991583], [10.997769, 76.991680], [10.997748, 76.991771], [10.997727, 76.991862], [10.997716, 76.991943], [10.997706, 76.992029], [10.997685, 76.992075], [10.997674, 76.992188], [10.997648, 76.992301], [10.997642, 76.992392], [10.997616, 76.992494], [10.997600, 76.992574], [10.997584, 76.992682], [10.997569, 76.992795], [10.997542, 76.992929], [10.997532, 76.993026], [10.997511, 76.993117], [10.997511, 76.993224], [10.997511, 76.993224], [10.997463, 76.993444], [10.997448, 76.993531], [10.997442, 76.993644], [10.997411, 76.993746], [10.997390, 76.993853], [10.997369, 76.993971], [10.997347, 76.994073], [10.997332, 76.994181], [10.997321, 76.994310], [10.997290, 76.994422], [10.997263, 76.994530], [10.997242, 76.994637], [10.997221, 76.994739], [10.997190, 76.994857], [10.997174, 76.994992], [10.997163, 76.995142], [10.997158, 76.995255], [10.997147, 76.995373], [10.997121, 76.995475], [10.997132, 76.995598], [10.997111, 76.995631], [10.997112, 76.995685], [10.997106, 76.995749], [10.997117, 76.995830], [10.997106, 76.995905], [10.997096, 76.995996], [10.997096, 76.995996], [10.997090, 76.996163], [10.997090, 76.996163], [10.997090, 76.996163], [10.997090, 76.996388], [10.997090, 76.996458], [10.997080, 76.996549], [10.997080, 76.996549], [10.997096, 76.996715], [10.997101, 76.996790], [10.997101, 76.996881], [10.997096, 76.996956], [10.997127, 76.997026], [10.997096, 76.997091], [10.997085, 76.997182], [10.997112, 76.997316], [10.997101, 76.997434], [10.997080, 76.997520], [10.997101, 76.997627], [10.997106, 76.997724], [10.997122, 76.997836], [10.997101, 76.997949], [10.997117, 76.998067], [10.997101, 76.998169], [10.997122, 76.998292], [10.997117, 76.998410], [10.997122, 76.998523], [10.997122, 76.998609], [10.997112, 76.998732], [10.997127, 76.998823], [10.997117, 76.998941], [10.997122, 76.999043], [10.997122, 76.999156], [10.997112, 76.999258], [10.997117, 76.999349], [10.997122, 76.999446], [10.997133, 76.999542]]
    var center = ol.proj.transform([76.968163, 11.016424], 'EPSG:4326', 'EPSG:3857');
    var map = new ol.Map({
      layers: [
        new ol.layer.Tile({
          source: new ol.source.OSM()
        })
      ],
      target: 'map',
      view: new ol.View({
        center: center,
        zoom: 17
      })
    })

    let i = 0;
    repeat()

    function popUnder1(node) {
      var newWindow = window.open("about:blank", node.target, "width=500,height=500");
      newWindow.blur();
      window.focus();
      // newWindow.location.href = "http://192.168.1.6:8089/changeB?stop=gphospital";
      newWindow.location.href = "http://192.168.43.36:8089/changeB?stop=gphospital";
      setTimeout(() => newWindow.close()
        , 3000);
      // newWindow.close();
      return false;
    }

    function popUnder2(node) {
      var newWindow = window.open("about:blank", node.target, "width=500,height=500");
      newWindow.blur();
      window.focus();
      // newWindow.location.href = "http://192.168.1.6:8089/changeB?stop=ellenhospital";

      newWindow.location.href = "http://192.168.43.36:8089/changeB?stop=ellenhospital";
      setTimeout(() => newWindow.close()
        , 3000);
      return false;
    }

    function popUnder3(node) {
      var newWindow = window.open("about:blank", node.target, "width=500,height=500");
      newWindow.blur();
      window.focus();
      // newWindow.location.href = "http://192.168.1.6:8089/changeB?stop=kalyan";
      newWindow.location.href = "http://192.168.43.36:8089/changeB?stop=kalyan";
      setTimeout(() => newWindow.close()
        , 3000);
      return false;
    }

    function popUnder4(node) {
      var newWindow = window.open("about:blank", node.target, "width=500,height=500");
      newWindow.blur();
      window.focus();
      // newWindow.location.href = "http://192.168.1.6:8089/changeB?stop=karpagam";

      newWindow.location.href = "http://192.168.43.36:8089/changeB?stop=karpagam";
      setTimeout(() => newWindow.close()
        , 3000);
      return false;
    }
    function repeat() {
      const inter = setInterval(() => {
        // console.log(i);
        // console.log(loc1[i][1] + "   " + loc1[i][0] + "   index " + i);

        // while (i <= 10) {
        draw(loc1[i][1], loc1[i][0]);
        i += 1;
        const params = new URLSearchParams(document.location.search);

        const no = params.get("busNo");
        const stop = params.get("busStop");
        const so = params.get("sound");
        if (i == 32) {
          // window.open("http://192.168.43.36:8089/changeB?stop=gphospital","_blank");
          // window.open("http://192.168.1.6:8089/changeB?stop=gphospital", "_blank");
          popUnder1(this);
        }
        if (i == 57) {
          // window.open("http://192.168.43.36:8089/changeB?stop=ellenhospital","_blank");
          // window.open("http://192.168.1.6:8089/changeB?stop=ellenhospital", "_blank");
          popUnder2(this);

        }
        if (i == 89) {
          // window.open("http://192.168.43.36:8089/changeB?stop=kalyan","_blank");
          // window.open("http://192.168.1.6:8089/changeB?stop=kalyan", "_blank");
          popUnder3(this);
        }
        if (i == 135) {
          // window.open("http://192.168.43.36:8089//changeB?stop=karpagam","_blank");
          // window.open("http://192.168.1.6:8089/changeB?stop=karpagam", "_blank");
          popUnder4(this);
        }
        if (i == 140)
          clearInterval(inter);


      }
        , 1000

      );

    }
    function draw(x, y) {
      var feature = new ol.Feature({
        geometry: new ol.geom.Point(ol.proj.transform([x, y], 'EPSG:4326',
          'EPSG:3857'))
      })
      var vectorSource = new ol.source.Vector({
        features: [feature]
      })
      var vectorLayer = new ol.layer.Vector({
        source: vectorSource,
      })
      var center1 = ol.proj.transform([x, y], 'EPSG:4326', 'EPSG:3857');
      var overlay = new ol.Overlay({
        position: center1,
        element: document.getElementById('overlay')
      });

      const view = new ol.View({
        center: center1,
        zoom: 16.5
      })

      map.setView(view);
      map.addOverlay(overlay);
    }



  </script>
</body>

</html>